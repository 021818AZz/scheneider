<!DOCTYPE html>
<html style="font-size: 47.2px;">
<head>
    <meta charset="utf-8">
    <title>Histórico de Saques - Microsoft</title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="full-screen" content="true">
    <meta name="x5-fullscreen" content="true">
    <meta name="360-fullscreen" content="true">
    <meta name="renderer" content="webkit">

    <link href="css/dark-theme.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: #0078D4;
        }

        html, body {
            width: 100%;
            background-color: #000000;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #0078D4;
        }

        .container {
            padding: 0 15px;
            max-width: 750px;
            margin: 0 auto;
        }

        .head[data-v-a53c4a36] {
            padding: 10px 0;
            background: #0078D4;
            color: #000000;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 120, 212, 0.2);
        }

        .back {
            cursor: pointer;
            padding: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            transition: background-color 0.3s ease;
        }

        .back:hover {
            background-color: rgba(0, 120, 212, 0.1);
        }

        .back img {
            width: 20px;
            height: 20px;
            filter: none;
        }

        .name {
            font-size: 16px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        .flex {
            display: flex;
            align-items: center;
        }

        .flex1 {
            flex: 1;
        }

        .tac {
            text-align: center;
        }

        /* Estilos do histórico */
        .summary-card {
            background: #000;
            border-radius: 12px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 2px 12px rgba(139, 69, 19, 0.08);
            border: 1px solid #e8d5c4;
        }

        .summary-stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }

        .stat-item {
            flex: 1;
            padding: 0 10px;
        }

        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--coffee-medium);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #8c735b;
            font-weight: 500;
        }

        .filter-tabs {
            display: flex;
            background: #000;
            border-radius: 10px;
            padding: 4px;
            margin: 15px 0;
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.1);
            border: 1px solid #e8d5c4;
        }

        .filter-tab {
            flex: 1;
            text-align: center;
            padding: 12px 8px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #8c735b;
        }

        .filter-tab.active {
            background: linear-gradient(135deg, var(--coffee-medium) 0%, var(--coffee-accent) 100%);
            color: white;
            box-shadow: 0 2px 6px rgba(139, 69, 19, 0.2);
        }

        .withdrawal-item {
            background: #000;
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.05);
            border: 1px solid #e8d5c4;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .withdrawal-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 69, 19, 0.1);
        }

        .withdrawal-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--coffee-medium);
            opacity: 0.7;
        }

        .withdrawal-info {
            flex: 1;
        }

        .withdrawal-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .withdrawal-amount {
            font-size: 18px;
            font-weight: bold;
            color: #000000;
        }

        .withdrawal-details {
            font-size: 13px;
            color: #8c735b;
            line-height: 1.5;
        }

        .withdrawal-details div {
            margin-bottom: 4px;
        }

        .withdrawal-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-completed {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-failed {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #8c735b;
        }

        .empty-state img {
            width: 80px;
            margin-bottom: 15px;
            opacity: 0.6;
        }

        .empty-state p {
            font-size: 14px;
            margin-top: 10px;
            color: #8c735b;
        }

        

        .error-message {
            background: #fdf2f0;
            color: #c44536;
            padding: 12px 15px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            border-left: 3px solid #c44536;
            font-size: 14px;
        }

        .bank-icon {
            width: 16px;
            height: 16px;
            margin-right: 6px;
            opacity: 0.7;
            vertical-align: middle;
        }

        .date-icon {
            width: 14px;
            height: 14px;
            margin-right: 6px;
            opacity: 0.7;
            vertical-align: middle;
        }

        .tax-info {
            font-size: 12px;
            color: #a08c7a;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #e8d5c4;
        }

        /* Animações */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Melhorias para telas pequenas */
        @media (max-width: 360px) {
            .container {
                padding: 0 12px;
            }
            
            .summary-card, .withdrawal-item {
                padding: 15px;
            }
            
            .withdrawal-amount {
                font-size: 16px;
            }
            
            .withdrawal-details {
                font-size: 12px;
            }
            
            .filter-tab {
                padding: 10px 6px;
                font-size: 13px;
            }
        }

        /* Melhorias para dispositivos com notch */
        @supports(padding: max(0px)) {
            .head[data-v-a53c4a36] {
                padding-top: max(10px, env(safe-area-inset-top));
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
            
            .container {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
            
            .content-container {
                padding-bottom: max(62px, env(safe-area-inset-bottom));
            }
        }

        /* Melhorias de acessibilidade */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }
    </style>
</head>
<body class="w856">
<div id="app" class="applang">
    <div data-v-6e534c71="" data-v-443ea612="" class="page">
        <div data-v-6e534c71="" class="headers">
            <div data-v-a53c4a36="" data-v-443ea612="" class="head" data-v-6e534c71="">
                <div data-v-a53c4a36="" class="container flex">
                    <div class="back" onclick="goBack()">
                        <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE1IDRMNy41IDExLjVMMTUgMTlMMTMuNSAyMEw0LjUgMTFMMTMuNSAyTDE1IDRaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K" alt="Voltar">
                    </div>
                    <div data-v-a53c4a36="" class="name tac flex1">Saques</div>
                    <div data-v-a53c4a36="" class="flex1"></div>
                </div>
            </div>
        </div>
        <div data-v-6e534c71="" id="scroll" class="content-container" style="padding-top: 0px; padding-bottom: 62px;">
            <div data-v-6e534c71="" id="content" class="content-scroll">
                <div data-v-443ea612="" data-v-6e534c71="" class="container fade-in">
                    
                    <!-- Cartão de Resumo -->
                    <div class="summary-card">
                        <div class="summary-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="totalWithdrawals">0</div>
                                <div class="stat-label">Total Saques</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="totalAmount">0 KZ</div>
                                <div class="stat-label">Valor Total</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="pendingCount">0</div>
                                <div class="stat-label">Pendentes</div>
                            </div>
                        </div>
                    </div>

                    <!-- Filtros -->
                    <div class="filter-tabs">
                        <div class="filter-tab active" onclick="filterWithdrawals('all')">Todos</div>
                        <div class="filter-tab" onclick="filterWithdrawals('pending')">Pendentes</div>
                        <div class="filter-tab" onclick="filterWithdrawals('completed')">Concluídos</div>
                    </div>

                    <div data-v-443ea612="" data-v-6e534c71="" class="itemBox">
                        <div data-v-443ea612="" data-v-6e534c71="" class="list" style="margin-top: 20px;" id="withdrawalList">
                            <!-- Histórico será carregado aqui -->
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Configurações
    const API_BASE_URL = 'https://bd-p4q7.onrender.com';
    let currentFilter = 'all';
    let allWithdrawals = [];

    // Inicialização
    document.addEventListener('DOMContentLoaded', function() {
        // Verificar se o usuário está autenticado
        if (!isTokenValid()) {
            window.location.href = '/index.html';
            return;
        }
        
        // Carregar histórico de saques
        loadWithdrawalHistory();
    });

    // Função para voltar
    function goBack() {
        window.history.back();
    }

    // Carregar histórico de saques
    async function loadWithdrawalHistory() {
        try {
            const token = getToken();
            
            const response = await fetch(`${API_BASE_URL}/api/withdrawals`, {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (!response.ok) {
                throw new Error('Erro ao carregar histórico');
            }
            
            const data = await response.json();
            
            if (data.success) {
                allWithdrawals = data.data.withdrawals || [];
                updateSummary();
                displayWithdrawals(allWithdrawals);
            } else {
                throw new Error(data.message || 'Erro ao carregar dados');
            }
        } catch (error) {
            console.error('Erro ao carregar histórico:', error);
            showError('Erro ao carregar histórico: ' + error.message);
        }
    }

    // Atualizar resumo
    function updateSummary() {
        const totalWithdrawals = allWithdrawals.length;
        const totalAmount = allWithdrawals.reduce((sum, w) => sum + w.amount, 0);
        const pendingCount = allWithdrawals.filter(w => w.status === 'pending').length;
        
        document.getElementById('totalWithdrawals').textContent = totalWithdrawals;
        document.getElementById('totalAmount').textContent = totalAmount.toLocaleString('pt-AO') + ' KZ';
        document.getElementById('pendingCount').textContent = pendingCount;
    }

    // Filtrar saques
    function filterWithdrawals(filter) {
        currentFilter = filter;
        
        // Atualizar tabs ativas
        document.querySelectorAll('.filter-tab').forEach(tab => {
            tab.classList.remove('active');
        });
        event.target.classList.add('active');
        
        let filteredWithdrawals = allWithdrawals;
        
        if (filter !== 'all') {
            filteredWithdrawals = allWithdrawals.filter(w => w.status === filter);
        }
        
        displayWithdrawals(filteredWithdrawals);
    }

    // Exibir lista de saques
    function displayWithdrawals(withdrawals) {
        const withdrawalList = document.getElementById('withdrawalList');
        
        if (withdrawals.length === 0) {
            withdrawalList.innerHTML = `
                <div class="empty-state">
                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTQwIDcyQzU3LjY3MzEgNzIgNzIgNTcuNjczMSA3MiA0MEM3MiAyMi4zMjY5IDU3LjY3MzEgOCA0MCA4QzIyLjMyNjkgOCA4IDIyLjMyNjkgOCA0MEM4IDU3LjY3MzEgMjIuMzI2OSA3MiA0MCA3MloiIGZpbGw9IiNFOEQ1QzQiLz4KPHBhdGggZD0iTTQyIDMySDM4VjUwSDQyVjMyWiIgZmlsbD0iIzhDNzM1QiIvPgo8cGF0aCBkPSJNNDAgNTZDNDEuNjU2OSA1NiA0MyA1NC42NTY5IDQzIDUzQzQzIDUxLjM0MzEgNDEuNjU2OSA1MCA0MCA1MEMzOC4zNDMxIDUwIDM3IDUxLjM0MzEgMzcgNTNDMzcgNTQuNjU2OSAzOC4zNDMxIDU2IDQwIDU2WiIgZmlsbD0iIzhDNzM1QiIvPgo8L3N2Zz4K" alt="Nenhum saque">
                    <p>Nenhum saque encontrado</p>
                </div>
            `;
            return;
        }
        
        // Ordenar por data (mais recente primeiro)
        withdrawals.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
        
        let html = '';
        
        withdrawals.forEach(withdrawal => {
            const date = new Date(withdrawal.created_at).toLocaleDateString('pt-AO');
            const time = new Date(withdrawal.created_at).toLocaleTimeString('pt-AO', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            const statusText = getStatusText(withdrawal.status);
            const statusClass = `status-${withdrawal.status}`;
            
            html += `
                <div class="withdrawal-item">
                    <div class="withdrawal-header">
                        <div class="withdrawal-amount">${withdrawal.amount.toLocaleString('pt-AO')} KZ</div>
                        <div class="withdrawal-status ${statusClass}">${statusText}</div>
                    </div>
                    <div class="withdrawal-details">
                        <div>
                            <img class="bank-icon" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTEyIDBINEMxLjc5IDAgMCAxLjc5IDAgNFYxMkMwIDEzLjIxIDEuNzkgMTQgNCAxNEgxMkMxMy4yMSAxNCAxNCAxMy4yMSAxNCAxMlY0QzE0IDEuNzkgMTMuMjEgMCAxMiAwWk0xMiAxMkg0VjRIMTJWMTRaTTYgOEg0VjEwSDZWOE0xMCA4SDhWMTBIMTBWOE0xMiA4SDEwVjEwSDEyVjhaIiBmaWxsPSIjOEM3MzVCIi8+Cjwvc3ZnPgo=" alt="Banco">
                            ${withdrawal.bank_name} • ${withdrawal.account_name}
                        </div>
                        <div>
                            <img class="date-icon" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQiIGhlaWdodD0iMTQiIHZpZXdCb3g9IjAgMCAxNCAxNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTExIDBIM0MxLjM0IDAgMCAxLjM0IDAgM1YxMUMwIDEyLjY2IDEuMzQgMTQgMyAxNEgxMUMxMi42NiAxNCAxNCAxMi42NiAxNCAxMVYzQzE0IDEuMzQgMTIuNjYgMCAxMSAwWk0xMiAxMUMxMiAxMS41NSAxMS41NSAxMiAxMSAxMkgzQzIuNDUgMTIgMiAxMS41NSAyIDExVjVIMTJWMTFaTTQgM0gxMFY0SDRWNloiIGZpbGw9IiM4QzczNUIiLz4KPC9zdmc+Cg==" alt="Data">
                            ${date} às ${time}
                        </div>
                    </div>
                    <div class="tax-info">
                        Líquido: ${withdrawal.net_amount.toLocaleString('pt-AO')} KZ (Taxa: ${withdrawal.tax.toLocaleString('pt-AO')} KZ)
                    </div>
                </div>
            `;
        });
        
        withdrawalList.innerHTML = html;
    }

    // Obter texto do status
    function getStatusText(status) {
        const statusMap = {
            'pending': 'Pendente',
            'completed': 'Concluído',
            'failed': 'Falhou'
        };
        
        return statusMap[status] || status;
    }

    // Mostrar erro
    function showError(message) {
        const withdrawalList = document.getElementById('withdrawalList');
        withdrawalList.innerHTML = `
            <div class="error-message">
                <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTggMEMzLjU4IDAgMCAzLjU4IDAgOFMzLjU4IDE2IDggMTZTMTYgMTIuNDIgMTYgOFMxMi40MiAwIDggMFpNOCAxNEM0LjY5IDE0IDIgMTEuMzEgMiA4UzQuNjkgMiA4IDJTMTQgNC42OSAxNCA4UzExLjMxIDE0IDggMTRaTTkgNUg3VjExSDlWNVpNOSAxMkg3VjE0SDlWMTJaIiBmaWxsPSIjYzQ0NTM2Ii8+Cjwvc3ZnPgo=" alt="Erro" style="width:16px;height:16px;vertical-align:middle;margin-right:8px;">
                ${message}
            </div>
        `;
    }

    // Funções de autenticação
    function isTokenValid() {
        const tokenData = localStorage.getItem('user_token');
        
        if (!tokenData) return false;
        
        try {
            const { token, expiry } = JSON.parse(tokenData);
            
            if (Date.now() > expiry) {
                localStorage.removeItem('user_token');
                localStorage.removeItem('user_mobile');
                localStorage.removeItem('user_id');
                return false;
            }
            
            return true;
        } catch (e) {
            console.error('Erro ao verificar token:', e);
            return false;
        }
    }

    function getToken() {
        const tokenData = localStorage.getItem('user_token');
        if (!tokenData) return null;
        
        try {
            const { token } = JSON.parse(tokenData);
            return token;
        } catch (e) {
            console.error('Erro ao obter token:', e);
            return null;
        }
    }
</script>
</body>
</html>