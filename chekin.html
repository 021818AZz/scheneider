<!DOCTYPE html>
<html class="pixel-ratio-3 retina android android-5 android-5-0 watch-active-state">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <title>Torres - Check-in Di√°rio</title>
    <!--<link rel="stylesheet" href="/static/home/css/framework7.ios.min.css">-->
    <link rel="stylesheet" type="text/css" href="css/app.css">
    <link rel="stylesheet" type="text/css" href="css/iconfont.css">
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/dropload.css"/>
    <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
    <script type="text/javascript" src="js/dropload.min.js"></script>
    <script type="text/javascript" src="js/layui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    
    <style type="text/css">
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            color: white;
        }

        .page-container {
            max-width: 450px;
            margin: 0 auto;
            padding: 0;
            position: relative;
            min-height: 100vh;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
        }

        /* Header Section */
        .header-banner {
            position: relative;
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 50%, #3730a3 100%) !important;
            color: white;
            text-align: center;
            padding: 20px;
            font-size: 18px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 20px rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header-banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .header-title {
            font-size: 20px;
            font-weight: bold;
            color: #ffffff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            z-index: 1;
        }

        /* Futuristic Background */
        .futuristic-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
            pointer-events: none;
        }

        /* Check-in Section */
        .checkin-container {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            padding: 30px 20px;
            color: white;
            text-align: center;
            position: relative;
            border-bottom: 1px solid rgba(99, 102, 241, 0.3);
        }

        .checkin-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 0 auto;
            max-width: 350px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(99, 102, 241, 0.2);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .checkin-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.4);
        }

        .checkin-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
            animation: progressBar 2s ease-in-out infinite;
        }

        @keyframes progressBar {
            0% { transform: translateX(-100%); }
            50% { transform: translateX(100%); }
            100% { transform: translateX(-100%); }
        }

        .checkin-title {
            font-size: 24px;
            font-weight: bold;
            color: #f8fafc;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .checkin-subtitle {
            font-size: 16px;
            color: #cbd5e1;
            margin-bottom: 25px;
        }

        .reward-amount {
            font-size: 52px;
            font-weight: bold;
            color: #10b981;
            margin: 20px 0;
            text-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { 
                transform: scale(1);
                text-shadow: 0 4px 8px rgba(16, 185, 129, 0.4);
            }
            50% { 
                transform: scale(1.05);
                text-shadow: 0 6px 12px rgba(16, 185, 129, 0.6);
            }
        }

        .reward-label {
            font-size: 16px;
            color: #cbd5e1;
            margin-bottom: 30px;
        }

        .checkin-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            color: white;
            border: none;
            border-radius: 15px;
            padding: 20px 30px;
            font-size: 20px;
            font-weight: bold;
            width: 100%;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .checkin-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .checkin-button:hover::before {
            left: 100%;
        }

        .checkin-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(16, 185, 129, 0.6);
        }

        .checkin-button:active {
            transform: translateY(-1px);
        }

        .checkin-button:disabled {
            background: linear-gradient(135deg, #475569 0%, #334155 50%, #1e293b 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .checkin-icon {
            font-size: 24px;
            transition: transform 0.3s ease;
        }

        .checkin-button:hover .checkin-icon {
            transform: scale(1.2) rotate(10deg);
        }

        /* Stats Section */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
            border-radius: 15px;
            padding: 25px 20px;
            text-align: center;
            color: white;
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.5);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
            animation: shine 3s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .stat-value {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }

        /* Calendar Section */
        .calendar-container {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
            border-radius: 20px;
            margin: 20px 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(10px);
        }

        .calendar-title {
            font-size: 20px;
            font-weight: bold;
            color: #f8fafc;
            margin-bottom: 20px;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }

        .calendar-day {
            text-align: center;
            padding: 12px 5px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .calendar-day:hover {
            transform: scale(1.1);
            z-index: 2;
        }

        .day-header {
            color: #94a3b8;
            font-weight: bold;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(99, 102, 241, 0.3);
        }

        .day-checked {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
            animation: bounceIn 0.6s ease;
        }

        .day-missed {
            background: rgba(71, 85, 105, 0.4);
            color: #64748b;
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .day-today {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.5);
            border: 2px solid #60a5fa;
            animation: pulse 2s infinite;
        }

        .day-future {
            background: rgba(30, 41, 59, 0.6);
            color: #94a3b8;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* History Section */
        .history-container {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8) 0%, rgba(15, 23, 42, 0.8) 100%);
            border-radius: 20px;
            margin: 20px 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(99, 102, 241, 0.2);
            backdrop-filter: blur(10px);
        }

        .history-title {
            font-size: 20px;
            font-weight: bold;
            color: #f8fafc;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .history-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .history-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
            border-bottom: 1px solid rgba(99, 102, 241, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .history-item::before {
            content: '';
            position: absolute;
            left: -100%;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(99, 102, 241, 0.1), transparent);
            transition: left 0.5s;
        }

        .history-item:hover::before {
            left: 100%;
        }

        .history-item:hover {
            background: rgba(99, 102, 241, 0.05);
            transform: translateX(10px);
            border-radius: 10px;
            padding-left: 15px;
            padding-right: 15px;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-date {
            font-size: 14px;
            color: #cbd5e1;
            position: relative;
            z-index: 1;
        }

        .history-amount {
            font-size: 16px;
            font-weight: bold;
            color: #10b981;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(16, 185, 129, 0.3);
        }

        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #94a3b8;
        }

        .empty-state-icon {
            font-size: 64px;
            color: #475569;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .empty-state-text {
            font-size: 16px;
            margin-bottom: 25px;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #3b82f6;
            font-size: 16px;
        }

        .next-checkin {
            text-align: center;
            margin-top: 20px;
            padding: 18px;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 12px;
            font-size: 14px;
            color: #cbd5e1;
            border: 1px solid rgba(99, 102, 241, 0.3);
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .next-checkin strong {
            color: #60a5fa;
            font-size: 16px;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(99, 102, 241, 0.3);
            border-radius: 50%;
            animation: floatParticle 20s infinite linear;
        }

        @keyframes floatParticle {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Particles Background -->
    <div class="particles" id="particles"></div>

    <!-- Futuristic SVG Background -->
    <div class="futuristic-bg">
        <svg width="100%" height="100%" viewBox="0 0 1200 800" xmlns="http://www.w3.org/2000/svg">
            <!-- City Skyline -->
            <path d="M0 600 L100 550 L150 580 L200 520 L300 560 L400 500 L500 540 L600 480 L700 520 L800 460 L900 500 L1000 440 L1100 480 L1200 420 L1200 800 L0 800 Z" 
                  fill="#1e293b" opacity="0.3"/>
            
            <!-- Autonomous Cars -->
            <g class="car-animation">
                <!-- Car 1 -->
                <rect x="200" y="550" width="80" height="30" rx="5" fill="#3b82f6" opacity="0.8">
                    <animate attributeName="x" from="-100" to="1300" dur="15s" repeatCount="indefinite"/>
                </rect>
                <circle cx="210" cy="580" r="8" fill="#1e293b">
                    <animate attributeName="cx" from="-90" to="1310" dur="15s" repeatCount="indefinite"/>
                </circle>
                <circle cx="270" cy="580" r="8" fill="#1e293b">
                    <animate attributeName="cx" from="30" to="1370" dur="15s" repeatCount="indefinite"/>
                </circle>
                
                <!-- Car 2 -->
                <rect x="600" y="500" width="70" height="25" rx="4" fill="#10b981" opacity="0.8">
                    <animate attributeName="x" from="1300" to="-100" dur="12s" repeatCount="indefinite"/>
                </rect>
                <circle cx="610" cy="525" r="7" fill="#1e293b">
                    <animate attributeName="cx" from="1310" to="-90" dur="12s" repeatCount="indefinite"/>
                </circle>
                <circle cx="660" cy="525" r="7" fill="#1e293b">
                    <animate attributeName="cx" from="1360" to="-40" dur="12s" repeatCount="indefinite"/>
                </circle>
                
                <!-- Car 3 -->
                <rect x="400" y="520" width="90" height="35" rx="6" fill="#8b5cf6" opacity="0.8">
                    <animate attributeName="x" from="-150" to="1250" dur="18s" repeatCount="indefinite"/>
                </rect>
                <circle cx="415" cy="555" r="9" fill="#1e293b">
                    <animate attributeName="cx" from="-135" to="1265" dur="18s" repeatCount="indefinite"/>
                </circle>
                <circle cx="475" cy="555" r="9" fill="#1e293b">
                    <animate attributeName="cx" from="-75" to="1325" dur="18s" repeatCount="indefinite"/>
                </circle>
            </g>
            
            <!-- Futuristic Buildings -->
            <rect x="100" y="400" width="40" height="200" fill="#334155" opacity="0.4"/>
            <rect x="160" y="350" width="35" height="250" fill="#475569" opacity="0.4"/>
            <rect x="220" y="320" width="30" height="280" fill="#64748b" opacity="0.4"/>
            <rect x="280" y="380" width="25" height="220" fill="#94a3b8" opacity="0.3"/>
            
            <!-- Glowing Windows -->
            <g opacity="0.6">
                <rect x="110" y="420" width="10" height="15" fill="#60a5fa">
                    <animate attributeName="opacity" values="0.3;1;0.3" dur="2s" repeatCount="indefinite"/>
                </rect>
                <rect x="170" y="370" width="8" height="12" fill="#10b981">
                    <animate attributeName="opacity" values="0.3;1;0.3" dur="1.5s" repeatCount="indefinite"/>
                </rect>
                <rect x="230" y="340" width="7" height="10" fill="#8b5cf6">
                    <animate attributeName="opacity" values="0.3;1;0.3" dur="2.5s" repeatCount="indefinite"/>
                </rect>
            </g>
            
            <!-- Floating Tech Elements -->
            <circle cx="300" cy="200" r="15" fill="none" stroke="#3b82f6" stroke-width="2" opacity="0.5">
                <animate attributeName="r" values="15;25;15" dur="3s" repeatCount="indefinite"/>
            </circle>
            <circle cx="500" cy="150" r="12" fill="none" stroke="#10b981" stroke-width="2" opacity="0.5">
                <animate attributeName="r" values="12;20;12" dur="2.5s" repeatCount="indefinite"/>
            </circle>
            <circle cx="700" cy="250" r="18" fill="none" stroke="#8b5cf6" stroke-width="2" opacity="0.5">
                <animate attributeName="r" values="18;28;18" dur="4s" repeatCount="indefinite"/>
            </circle>
        </svg>
    </div>

    <div class="page-container">
        <div class="header-banner">
            <div class="header-title">
                üöÄ Check-in Di√°rio
            </div>
        </div>
        
        <div class="checkin-container">
            <div class="checkin-card">
                <div class="checkin-title">Check-in do Futuro</div>
                <div class="checkin-subtitle">Conecte-se ao amanh√£ e receba suas recompensas</div>
                
                <div class="reward-amount" id="reward-amount">+5 KZ</div>
                <div class="reward-label">Recompensa de Hoje</div>
                
                <button class="checkin-button" id="checkin-button">
                    <span class="checkin-icon">‚ö°</span>
                    <span id="checkin-button-text">Fazer Check-in</span>
                </button>

                <div class="next-checkin" id="next-checkin-container" style="display: none;">
                    Pr√≥ximo check-in dispon√≠vel em: <strong id="next-checkin-time">--:--:--</strong>
                </div>
            </div>
        </div>

        <div class="stats-container">
            <div class="stat-card">
                <div class="stat-value" id="total-checkins">0</div>
                <div class="stat-label">Total de Check-ins</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="total-rewards">0 KZ</div>
                <div class="stat-label">Total Recebido</div>
            </div>
        </div>

        <div class="calendar-container">
            <div class="calendar-title">üìÖ Calend√°rio Futurista</div>
            <div class="calendar-grid" id="calendar-grid">
                <!-- Dias da semana -->
                <div class="calendar-day day-header">D</div>
                <div class="calendar-day day-header">S</div>
                <div class="calendar-day day-header">T</div>
                <div class="calendar-day day-header">Q</div>
                <div class="calendar-day day-header">Q</div>
                <div class="calendar-day day-header">S</div>
                <div class="calendar-day day-header">S</div>
                <!-- Dias ser√£o preenchidos via JavaScript -->
            </div>
        </div>

        <div class="history-container">
            <div class="history-title">üïê Hist√≥rico de Check-ins</div>
            <ul class="history-list" id="history-list">
                <div class="loading">üîÑ Conectando ao futuro...</div>
            </ul>
        </div>
    </div>

    <div style="height: 80px;"></div>

    <footer>
        <div class="foot_bo">
            <a href="/indice.html">
                <img src="footer/inicio.png"/>
                <p>In√≠cio</p>
            </a>
        </div>

        <div class="foot_bo">
            <a href="transacoes.html">
                <img src="footer/meusprodutos.png"/>
                <p>Registros</p>
            </a>
        </div>

        <div class="foot_bo">
            <a href="/mostrar.html">
                <img src="footer/mostrar.png" class="game1"/>
                <p>Mostrar</p>
            </a>
        </div>

        <div class="foot_bo">
            <a href="/compartilhar.html">
                <img src="footer/compartilhar.png"/>
                <p>Compartilhar</p>
            </a>
        </div>

        <div class="foot_bo">
            <a href="meu.html">
                <img src="footer/meu.png"/>
                <p>Meu</p>
            </a>
        </div>
    </footer>

    <script type="text/javascript">
        // Configura√ß√£o da API
        const API_BASE_URL = 'https://bd-p4q7.onrender.com';

        // Vari√°veis globais
        let checkinStatus = null;
        let checkinHistory = [];

        // Inicializar part√≠culas
        function initParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 1;
                const left = Math.random() * 100;
                const animationDuration = Math.random() * 20 + 10;
                const animationDelay = Math.random() * 5;
                
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${left}vw`;
                particle.style.animationDuration = `${animationDuration}s`;
                particle.style.animationDelay = `${animationDelay}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Fun√ß√£o para mostrar toast
        function showToast(message, type = 'info') {
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "center",
                stopOnFocus: true,
                className: type === 'error' ? 'toast-error' : 
                          type === 'success' ? 'toast-success' : 'toast-info',
                style: {
                    width: "100%",
                    left: "0",
                    right: "0",
                    borderRadius: "0",
                    textAlign: "center",
                    padding: "15px",
                    fontSize: "14px",
                    fontWeight: "bold"
                }
            }).showToast();
        }

        // Fun√ß√£o para obter o token do localStorage
        function getToken() {
            const tokenData = localStorage.getItem('user_token');
            if (!tokenData) {
                return null;
            }
            
            try {
                const { token, expiry } = JSON.parse(tokenData);
                
                // Verificar se o token expirou
                if (Date.now() > expiry) {
                    localStorage.removeItem('user_token');
                    localStorage.removeItem('user_id');
                    return null;
                }
                
                return token;
            } catch (e) {
                console.error('Erro ao obter token:', e);
                return null;
            }
        }

        // Fun√ß√£o para redirecionar para login se n√£o estiver autenticado
        function redirectToLogin() {
            showToast('Sess√£o expirada. Fa√ßa login novamente.', 'error');
            setTimeout(() => {
                window.location.href = '/login.html';
            }, 2000);
        }

        // Fun√ß√£o para verificar status do check-in
        async function fetchCheckinStatus() {
            const token = getToken();
            
            if (!token) {
                redirectToLogin();
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/checkin/status`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    redirectToLogin();
                    return;
                }

                const data = await response.json();
                
                if (data.success) {
                    checkinStatus = data.data;
                    updateCheckinButton();
                    updateNextCheckinTimer();
                } else {
                    showToast('Erro ao carregar status do check-in', 'error');
                }
            } catch (error) {
                console.error('Erro ao buscar status do check-in:', error);
                showToast('Erro de conex√£o com o servidor', 'error');
            }
        }

        // Fun√ß√£o para buscar hist√≥rico de check-ins
        async function fetchCheckinHistory() {
            const token = getToken();
            
            if (!token) {
                redirectToLogin();
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/checkin/history`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.status === 401) {
                    redirectToLogin();
                    return;
                }

                const data = await response.json();
                
                if (data.success) {
                    checkinHistory = data.data.checkins || [];
                    displayCheckinHistory();
                    updateStatistics();
                    generateCalendar();
                } else {
                    showToast('Erro ao carregar hist√≥rico', 'error');
                    displayEmptyHistory();
                }
            } catch (error) {
                console.error('Erro ao buscar hist√≥rico:', error);
                showToast('Erro de conex√£o com o servidor', 'error');
                displayEmptyHistory();
            }
        }

        // Fun√ß√£o para realizar o check-in
        async function performCheckin() {
            const token = getToken();
            
            if (!token) {
                redirectToLogin();
                return;
            }

            const button = document.getElementById('checkin-button');
            if (!button) {
                console.error('Bot√£o de check-in n√£o encontrado');
                return;
            }
            
            button.disabled = true;
            button.innerHTML = '<span class="checkin-icon">‚è≥</span><span>Processando...</span>';

            try {
                const response = await fetch(`${API_BASE_URL}/api/checkin`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();
                
                if (data.success) {
                    showToast(`‚úÖ Check-in realizado! +5 KZ adicionados`, 'success');
                    
                    // Atualizar interface
                    setTimeout(() => {
                        fetchCheckinStatus();
                        fetchCheckinHistory();
                    }, 1000);
                } else {
                    showToast(data.message || 'Erro ao fazer check-in', 'error');
                    button.disabled = false;
                    updateCheckinButton();
                }
            } catch (error) {
                console.error('Erro ao fazer check-in:', error);
                showToast('Erro de conex√£o com o servidor', 'error');
                button.disabled = false;
                updateCheckinButton();
            }
        }

        // Fun√ß√£o para atualizar o bot√£o de check-in (CORRIGIDA)
        function updateCheckinButton() {
            const button = document.getElementById('checkin-button');
            const buttonText = document.getElementById('checkin-button-text');
            
            // Verificar se os elementos existem
            if (!button || !buttonText) {
                console.log('Elementos do bot√£o ainda n√£o carregados');
                return;
            }
            
            if (!checkinStatus) {
                button.disabled = true;
                buttonText.textContent = 'Carregando...';
                return;
            }

            if (checkinStatus.can_checkin) {
                button.disabled = false;
                buttonText.textContent = 'Fazer Check-in';
                button.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%)';
                
                // Adicionar evento de clique apenas uma vez
                button.onclick = performCheckin;
            } else {
                button.disabled = true;
                buttonText.textContent = 'Check-in J√° Realizado';
                button.style.background = 'linear-gradient(135deg, #475569 0%, #334155 50%, #1e293b 100%)';
            }
        }

        // Fun√ß√£o para atualizar o timer do pr√≥ximo check-in
        function updateNextCheckinTimer() {
            if (!checkinStatus || checkinStatus.can_checkin) {
                document.getElementById('next-checkin-container').style.display = 'none';
                return;
            }

            const nextCheckinTime = document.getElementById('next-checkin-time');
            if (!nextCheckinTime) return;

            const nextCheckin = new Date(checkinStatus.next_checkin);
            
            function updateTimer() {
                const now = new Date();
                const diff = nextCheckin - now;
                
                if (diff <= 0) {
                    nextCheckinTime.textContent = 'AGORA!';
                    fetchCheckinStatus();
                    return;
                }
                
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                nextCheckinTime.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateTimer();
            setInterval(updateTimer, 1000);
            document.getElementById('next-checkin-container').style.display = 'block';
        }

        // Fun√ß√£o para exibir hist√≥rico de check-ins
        function displayCheckinHistory() {
            const historyList = document.getElementById('history-list');
            
            if (!historyList) return;

            if (!checkinHistory || checkinHistory.length === 0) {
                displayEmptyHistory();
                return;
            }

            historyList.innerHTML = '';

            checkinHistory.forEach(checkin => {
                const li = document.createElement('li');
                li.className = 'history-item';
                
                const date = new Date(checkin.checkin_date).toLocaleDateString('pt-BR', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                li.innerHTML = `
                    <div class="history-date">${date}</div>
                    <div class="history-amount">+${checkin.amount_received || 5} KZ</div>
                `;
                
                historyList.appendChild(li);
            });
        }

        // Fun√ß√£o para exibir estado vazio do hist√≥rico
        function displayEmptyHistory() {
            const historyList = document.getElementById('history-list');
            if (!historyList) return;
            
            historyList.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìÖ</div>
                    <div class="empty-state-text">Nenhum check-in realizado ainda</div>
                </div>
            `;
        }

        // Fun√ß√£o para atualizar estat√≠sticas
        function updateStatistics() {
            const totalCheckins = checkinHistory.length;
            const totalRewards = checkinHistory.reduce((sum, checkin) => sum + (checkin.amount_received || 5), 0);

            const totalCheckinsEl = document.getElementById('total-checkins');
            const totalRewardsEl = document.getElementById('total-rewards');
            
            if (totalCheckinsEl) totalCheckinsEl.textContent = totalCheckins;
            if (totalRewardsEl) totalRewardsEl.textContent = `${totalRewards} KZ`;
        }

        // Fun√ß√£o para gerar calend√°rio
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            if (!calendarGrid) return;
            
            // Limpar dias existentes (exceto cabe√ßalho)
            while (calendarGrid.children.length > 7) {
                calendarGrid.removeChild(calendarGrid.lastChild);
            }

            const today = new Date();
            const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);
            
            // Adicionar dias vazios no in√≠cio do m√™s
            const firstDayOfWeek = firstDayOfMonth.getDay();
            for (let i = 0; i < firstDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day day-future';
                calendarGrid.appendChild(emptyDay);
            }

            // Adicionar dias do m√™s
            for (let day = 1; day <= lastDayOfMonth.getDate(); day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;

                const currentDate = new Date(today.getFullYear(), today.getMonth(), day);
                
                // Verificar se √© hoje
                if (day === today.getDate() && today.getMonth() === currentDate.getMonth()) {
                    dayElement.classList.add('day-today');
                }
                
                // Verificar se houve check-in neste dia
                const hasCheckin = checkinHistory.some(checkin => {
                    const checkinDate = new Date(checkin.checkin_date);
                    return checkinDate.getDate() === day && 
                           checkinDate.getMonth() === currentDate.getMonth() &&
                           checkinDate.getFullYear() === currentDate.getFullYear();
                });

                if (hasCheckin) {
                    dayElement.classList.add('day-checked');
                } else if (currentDate < today) {
                    dayElement.classList.add('day-missed');
                } else if (currentDate > today) {
                    dayElement.classList.add('day-future');
                }

                calendarGrid.appendChild(dayElement);
            }
        }

        // Fun√ß√£o de inicializa√ß√£o
        function init() {
            const token = getToken();
            
            if (!token) {
                redirectToLogin();
                return;
            }

            // Inicializar part√≠culas
            initParticles();

            // Carregar dados do check-in
            fetchCheckinStatus();
            fetchCheckinHistory();

            // Configurar atualiza√ß√£o autom√°tica a cada minuto
            setInterval(() => {
                fetchCheckinStatus();
            }, 60000);
        }

        // Inicializar quando o documento estiver pronto
        $(document).ready(function() {
            // Pequeno delay para garantir que todos os elementos est√£o carregados
            setTimeout(init, 100);
        });
    </script>

    <style>
        .game1 {
            border-radius: 50%;
            animation: rotate1 2s linear infinite;
        }
        
        @keyframes rotate1 {
            0% {
                transform: rotateZ(0deg);
            }
            100% {
                transform: rotateZ(360deg);
            }
        }

        /* Estilos para os toasts */
        .toast-success {
            background: linear-gradient(135deg, #10b981, #059669, #047857) !important;
        }
        
        .toast-error {
            background: linear-gradient(135deg, #ef4444, #dc2626, #b91c1c) !important;
        }
        
        .toast-info {
            background: linear-gradient(135deg, #3b82f6, #2563eb, #1d4ed8) !important;
        }

        /* Footer styles */
        footer {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            border-top: 1px solid rgba(99, 102, 241, 0.3);
        }

        .foot_bo a {
            transition: all 0.3s ease;
        }

        .foot_bo a:hover {
            transform: translateY(-5px);
        }

        .foot_bo a:hover img {
            filter: brightness(1.2);
        }
    </style>
</body>
</html>