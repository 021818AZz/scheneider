<!DOCTYPE html>
<html style="font-size: 47.2px;">
<head>
    <meta charset="utf-8">
    <title>Detalhes confiáveis</title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no,viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="full-screen" content="true">
    <meta name="x5-fullscreen" content="true">
    <meta name="360-fullscreen" content="true">
    <meta name="renderer" content="webkit">
    <style>* {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            width: 100%;
        }</style>
    <link href="app.c1933b14.css" rel="preload" as="style">
    <link href="chunk-vant.d14f5539.css" rel="preload" as="style">
    <link href="chunk-vendors.794edbf9.css" rel="preload" as="style">
    <link href="chunk-vant.d14f5539.css" rel="stylesheet">
    <link href="chunk-vendors.794edbf9.css" rel="stylesheet">
    <link href="app.c1933b14.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="chunk-495634f2.19df3560.css">
    <link rel="stylesheet" type="text/css" href="chunk-5576a184.9f52f39a.css">

    <link rel="stylesheet" type="text/css" href="chunk-3b94db02.5929650c.css">
    <link rel="stylesheet" type="text/css" href="chunk-a6d04a00.3a1821fc.css">
    <link rel="stylesheet" type="text/css" href="chunk-9884782a.e91864af.css">
    <link rel="stylesheet" type="text/css" href="chunk-bb5a8aa2.30a0a654.css">
    <link rel="stylesheet" type="text/css" href="chunk-5ba702ec.7902583a.css">
    <link rel="stylesheet" type="text/css" href="chunk-46c4d9be.73725c2e.css">
    <link rel="stylesheet" type="text/css" href="chunk-07731f62.d388cdd4.css">
    <link rel="stylesheet" type="text/css" href="chunk-159f11a9.a3a3db2b.css">
    <link rel="stylesheet" type="text/css" href="chunk-179866d5.1f9c3375.css">
    <link rel="stylesheet" type="text/css" href="chunk-1faa2bab.6fd50a6f.css">
    <link rel="stylesheet" type="text/css" href="chunk-15e30c0e.9dcbd293.css">
    <link rel="stylesheet" type="text/css" href="chunk-d844143c.96bbb122.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.css">
    <style>
        :root {
            --coffee-primary: #000000;
            --coffee-secondary: #333333;
            --coffee-light: #F5F5F5;
            --coffee-dark: #000000;
            --coffee-accent: #333333;
        }
        
        body {
            background-color: #f5f1eb;
            color: #000000;
        }
        
        .page {
            background-color: #f5f1eb;
        }
        
        .headers .head {
            background-color: var(--coffee-primary);
        }
        
        .headers .name {
            color: white;
        }
        
        .item {
            background-color: white;
            border-radius: 8px;
            margin: 10px;
            box-shadow: 0 2px 8px rgba(139, 69, 19, 0.1);
        }
        
        .item .container {
            padding: 15px;
        }
        
        .item .he {
            border-bottom: 1px solid var(--coffee-light);
            padding-bottom: 10px;
            margin-bottom: 10px;
        }
        
        .item .name1 {
            color: var(--coffee-primary);
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .item .p {
            color: #000000;
            line-height: 1.4;
            margin-bottom: 15px;
        }
        
        .it1 li {
            padding: 8px 0;
            border-bottom: 1px solid #f0e6d6;
        }
        
        .it1 li:last-child {
            border-bottom: none;
        }
        
        .it1 .s {
            color: var(--coffee-primary);
            font-weight: bold;
        }
        
        .cname {
            margin-bottom: 10px;
        }
        
        .color1 {
            color: var(--coffee-secondary);
            font-size: 14px;
        }
        
        .val input {
            background-color: #f9f5f0;
            border: 1px solid var(--coffee-light);
            border-radius: 6px;
            padding: 12px;
            width: 100%;
            color: var(--coffee-dark);
        }
        
        button.bbtyn {
            width: 100%;
            padding: 14px 0;
            background: var(--coffee-primary);
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }
        button.bbtyn:disabled {
            background: rgba(0,0,0,0.5) !important;
            cursor: not-allowed;
        }
        button.bbtyn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .pic img[data-v-7cbde459] {
        width: 50%;
    }
    .pic {
    text-align: center;
    }
    .purchase-message {
        margin: 10px 0;
        padding: 10px;
        border-radius: 5px;
        text-align: center;
        font-size: 14px;
    }
    .success-message {
        background: #e8f5e8;
        color: #2d5a2d;
        border: 1px solid #c3e6c3;
    }
    .error-message {
        background: #f8e8e8;
        color: #5a2d2d;
        border: 1px solid #f5c6c6;
    }
    .loading {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid #ffffff;
        border-radius: 50%;
        border-top-color: transparent;
        animation: spin 1s ease-in-out infinite;
        margin-right: 10px;
    }
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    </style>
</head>
<body class="w856">
<div id="app" class="applang"><!---->
    <div data-v-6e534c71="" data-v-7cbde459="" class="page">
        <div data-v-7cbde459="" data-v-6e534c71="" class="bg"><img data-v-7cbde459="" data-v-6e534c71=""
                                                                   src="https://i.postimg.cc/0NDGM38P/bg-ai-ecc46501.png" alt=""></div>
        <div data-v-6e534c71="" class="headers">
            <div data-v-a53c4a36="" data-v-7cbde459="" class="head" data-v-6e534c71="">
                <div data-v-a53c4a36="" class="container flex">
                    <div data-v-a53c4a36="" class="back" onclick="window.location.href='/produtos.html'"><img data-v-a53c4a36=""
                                                              src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAALkSURBVHgB7ZnPThNBHMd/v9lpK6XFJrWlG5DsoYeqkNSbN/UN8AmEJ9A3EJ/A+ATi0ZMc9YTePFbgwIHDJqBZMDEDLGvTf+NvhBVKgENnZnvZT9J0822y+/3u7Mzvt1OAlJSUlBQNEMbAzMz9Zpc5L6SUh92QrwjREjAiHBJGme8xvk53roSIkCkMAAS8hBFhkCC1WsMj8x/psBRryOAxaJBYAGVeZrLrdOhd1JmUb0GDRB6h68yjhNfB3uYqaGB9BEolr3S9+Y0V0MTqKqTMZwtT6zRXm5cu+j7Y3VgCA1h9hHLF4jv6ag6ruBbsfl8CQ1gLUL27QOZx8aImEVodhstgECtzoDo3/woBl4ZEBL/D2FPhj160rsJ4gH/mJVsZEsk8WjB/emqD3GQ+8Fs+WMBYgHGYP72EASpzD54z6axeOrMg8w9tmldoz4Gqu7B4lXlu+c6fX0qDCnWWiFxVWeosz3UJ8tnB7uYaJIDeCKDzBs46SynPJJDLSZlXmF1GJX7pdaUPCaIVwOHOslpp6LBNn8/06HxlnD2pVJpNSAgHNAhFIPK5uQ/AB4c0BYJYRy4b+ZwroigIwDJaARRR9DOcyrt7ksnhu84H3mTuzk4U/QrBItoBFGFII1F0BaJsxBr1Qhw4ztsOYSSAIjoOgkJxuk3O67GmQkiH1bOOu91uB22wgLEAipPj/b3ilKvqgBdrVB9uYUY2bIUwGkARHgV+kiGMB1DcFKJanmgJIXpgCCsBFCrE5O0qVWmsxZoK0e1n6pVyfstUCGsBFCdHB9uXQ1CKQqefnY2OD1pgAOvbKnmn/IlajKGCRluKnupiwQBWR0AhhN+rlO9tdfvtOq2rhf8/MKzlJ6dvReH+DmhgPYDiNIS70+tToaN5EOu0Lzqbo9rxh5ZfGJHE9kZ9eqGfyLBV2pEberHnMNBq/BLdnb4qhETmgwZj+YPD85qlk17nUV9y8fvHxjdISUlJSRkXfwFHSxhpEL4NbwAAAABJRU5ErkJggg=="
                                                              alt=""></div><!---->
                    <div data-v-a53c4a36="" class="name tac"> Microsoft 2</div>
                    <div data-v-a53c4a36="" class="flex1"></div><!----><!----></div>
                <div data-v-a53c4a36=""><!----></div>
            </div>
        </div>
        <div data-v-6e534c71="" id="scroll" class="content-container" style="padding-top: 42px;">
            <div data-v-6e534c71="" id="content" class="content-scroll">
                <div data-v-7cbde459="" data-v-6e534c71="" class="pic"><img data-v-7cbde459="" data-v-6e534c71=""
                                                                            src="img/baner3.jpg"
                                                                            alt="Microsoft 2"></div>
                <div data-v-7cbde459="" data-v-6e534c71="" class="item">
                    <div data-v-7cbde459="" data-v-6e534c71="" class="container">
                        <div data-v-7cbde459="" data-v-6e534c71="" class="he flex">
                            <div data-v-7cbde459="" data-v-6e534c71="" class="ico"><img data-v-7cbde459=""
                                                                                        data-v-6e534c71="" alt=""
                                                                                        data-src="img/baner3.jpg"
                                                                                        src="img/baner3.jpg"
                                                                                        lazy="loaded"></div>
                            <div data-v-7cbde459="" data-v-6e534c71="" class="flex1"><span data-v-7cbde459=""
                                                                                           data-v-6e534c71="">Rendimento diário: 1,000 KZ</span>
                            </div>
                        </div>
                        <div data-v-7cbde459="" data-v-6e534c71="" class="name1">Microsoft 2</div>
                        <div data-v-7cbde459="" data-v-6e534c71="" class="p">
                            Organize a oportunidade de entrada e saída por meio de dados de IA e adicione lógica, como filtragem de média móvel, simultaneamente para reduzir impactos emocionais artificiais. Ao mesmo tempo em que melhora os retornos e garante a segurança do principal, a taxa de precisão da entrada e saída é significativamente aprimorada.
                        </div>
                        <ul data-v-7cbde459="" data-v-6e534c71="" class="it1">
                            <li data-v-7cbde459="" data-v-6e534c71="" class="flex">
                                <div data-v-7cbde459="" data-v-6e534c71="" class="flex1">Ciclo de tratamento：</div>
                                <div data-v-7cbde459="" data-v-6e534c71="" class="s">90 Dias</div>
                            </li>
                            <li data-v-7cbde459="" data-v-6e534c71="" class="flex">
                                <div data-v-7cbde459="" data-v-6e534c71="" class="flex1">Tipo de negociação：</div>
                                <div data-v-7cbde459="" data-v-6e534c71="" class="s">Microsoft 2</div>
                            </li>
                            <li data-v-7cbde459="" data-v-6e534c71="" class="flex">
                                <div data-v-7cbde459="" data-v-6e534c71="" class="flex1">Preço de negociação：</div>
                                <div data-v-7cbde459="" data-v-6e534c71="" class="s">5,000 KZ</div>
                            </li>
                            <li data-v-7cbde459="" data-v-6e534c71="" class="flex">
                                <div data-v-7cbde459="" data-v-6e534c71="" class="flex1">Valor total da renda：</div>
                                <div data-v-7cbde459="" data-v-6e534c71="" class="s">90,000 KZ</div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div data-v-7cbde459="" data-v-6e534c71="" class="x"></div>
                <div data-v-7cbde459="" data-v-6e534c71="" class="item">
                    <div data-v-7cbde459="" data-v-6e534c71="" class="container">
                        <div data-v-7cbde459="" data-v-6e534c71="" class="cname flex">
                            <div data-v-7cbde459="" data-v-6e534c71="" class="flex1">Quantidade de entrada</div>
                            <div data-v-7cbde459="" data-v-6e534c71="" class="color1">
                                Saldo disponível：<span id="user-balance">Carregando...</span>
                            </div>
                        </div>

                        <div data-v-7cbde459="" data-v-6e534c71="" class="val">
                            <input data-v-7cbde459="" data-v-6e534c71="" 
                                type="number" 
                                placeholder="Digite o valor" 
                                name="amount"
                                value="5000"
                                readonly
                                style="background: #f9f5f0; text-align: center; font-weight: bold; color: #000000;">
                        </div>
                        
                        <div id="purchase-message" class="purchase-message" style="display: none;"></div>
                        
                            <button class="bbtyn" id="buy-button" onclick="buyProduct()">
                            <span id="button-text">Comprar Microsoft 2 - 5,000 KZ</span>
                            <span id="button-loading" class="loading" style="display: none;"></span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/noty/3.1.4/noty.min.js"></script>

<script>
// Configurações do produto PARA PRODUÇÃO
const PRODUCT_CONFIG = {
    id: 2,
    name: "VIP 2",
    price: 10000, // em KZ
    daily_return: 1000, // em KZ
    cycle_days: 90,
    total_return: 90000, // em KZ
    payout_interval: 24 * 60 * 60 * 1000 // 24 HORAS em milissegundos (PRODUÇÃO)
};

// Função para obter o token
function getToken() {
    try {
        const tokenData = localStorage.getItem('user_token');
        if (tokenData) {
            const parsed = JSON.parse(tokenData);
            return parsed.token || parsed.access_token || parsed;
        }
        return null;
    } catch (error) {
        console.error('Erro ao obter token:', error);
        return null;
    }
}

// Função para carregar saldo do usuário
async function loadUserBalance() {
    const token = getToken();
    if (!token) {
        document.getElementById('user-balance').textContent = 'Faça login';
        document.getElementById('buy-button').disabled = true;
        return;
    }

    try {
        const response = await fetch('https://bd-p4q7.onrender.com/api/user/profile', {
            method: 'GET',
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
            }
        });

        if (response.ok) {
            const data = await response.json();
            if (data.success) {
                const balance = data.data.wallet_balance;
                document.getElementById('user-balance').textContent = balance + ' KZ';
                updateBuyButton(balance);
            }
        } else {
            throw new Error('Erro ao carregar saldo');
        }
    } catch (error) {
        console.error('Erro ao carregar saldo:', error);
        document.getElementById('user-balance').textContent = 'Erro ao carregar';
        document.getElementById('buy-button').disabled = true;
    }
}

// Função para atualizar estado do botão de compra
function updateBuyButton(balance) {
    const buyButton = document.getElementById('buy-button');
    const messageElement = document.getElementById('purchase-message');
    
    if (balance >= PRODUCT_CONFIG.price) {
    buyButton.style.background = '#000000';
        buyButton.disabled = false;
        messageElement.style.display = 'none';
    } else {
    buyButton.style.background = 'rgba(0,0,0,0.5)';
        buyButton.disabled = true;
        messageElement.textContent = 'Saldo insuficiente. Recarregue sua conta.';
        messageElement.className = 'purchase-message error-message';
        messageElement.style.display = 'block';
    }
}

// Função principal de compra
async function buyProduct() {
    const token = getToken();
    
    if (!token) {
        showNotification('Por favor, faça login primeiro', 'error');
        window.location.href = '/index.html';
        return;
    }

    const buyButton = document.getElementById('buy-button');
    const buttonText = document.getElementById('button-text');
    const buttonLoading = document.getElementById('button-loading');
    const messageElement = document.getElementById('purchase-message');
    
    // Desabilitar botão durante a compra
    buyButton.disabled = true;
    buttonText.textContent = 'Processando...';
    buttonLoading.style.display = 'inline-block';

    try {
        const response = await fetch('https://bd-p4q7.onrender.com/api/purchase', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + token,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                product_id: PRODUCT_CONFIG.id,
                product_name: PRODUCT_CONFIG.name,
                amount: PRODUCT_CONFIG.price,
                quantity: 1,
                daily_return: PRODUCT_CONFIG.daily_return,
                cycle_days: PRODUCT_CONFIG.cycle_days
            })
        });

        const data = await response.json();

        if (data.success) {
            showNotification('✅ Compra realizada com sucesso! Rendimentos diários de 1,000 KZ iniciados.', 'success');
            
            // Mostrar mensagem de sucesso
            messageElement.textContent = 'Compra realizada! Rendimentos começam em 24 horas.';
            messageElement.className = 'purchase-message success-message';
            messageElement.style.display = 'block';
            
            // Atualizar saldo na interface
            document.getElementById('user-balance').textContent = data.data.new_balance + ' KZ';
            updateBuyButton(data.data.new_balance);
            
            // Redirecionar para histórico após 3 segundos
            setTimeout(() => {
                window.location.href = '/tarefa.html';
            }, 3000);
            
        } else {
            showNotification('❌ ' + data.message, 'error');
            messageElement.textContent = data.message;
            messageElement.className = 'purchase-message error-message';
            messageElement.style.display = 'block';
        }

    } catch (error) {
        console.error('Erro na compra:', error);
        showNotification('❌ Erro na conexão. Tente novamente.', 'error');
        messageElement.textContent = 'Erro na conexão. Tente novamente.';
        messageElement.className = 'purchase-message error-message';
        messageElement.style.display = 'block';
    } finally {
    // Reabilitar botão
    buttonText.textContent = 'Comprar Microsoft 2 - 5,000 KZ';
        buttonLoading.style.display = 'none';
        updateBuyButton(parseInt(document.getElementById('user-balance').textContent) || 0);
    }
}

// Função de notificação
function showNotification(message, type) {
    new Noty({
        type: type,
        text: message,
        timeout: 5000,
        progressBar: true,
        theme: 'mint',
        animation: {
            open: 'animated bounceInRight',
            close: 'animated bounceOutRight'
        }
    }).show();
}

// Carregar saldo quando a página carregar
document.addEventListener('DOMContentLoaded', function() {
    loadUserBalance();
    
    // Verificar saldo a cada 30 segundos
    setInterval(loadUserBalance, 30000);
});

// Verificar autenticação ao carregar
window.addEventListener('load', function() {
    const token = getToken();
    if (!token) {
        showNotification('Faça login para comprar produtos', 'warning');
    }
});
</script>

<style>
    .van-toast {
        position: fixed;
        top: 50%;
        left: 50%;
        display: -webkit-box;
        display: -webkit-flex;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -webkit-flex-direction: column;
        flex-direction: column;
        -webkit-box-align: center;
        -webkit-align-items: center;
        align-items: center;
        -webkit-box-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        box-sizing: content-box;
        width: 85px;
        max-width: 70%;
        min-height: 1.51724rem;
        padding: .27586rem;
        color: #fff;
        font-size: .24138rem;
        white-space: pre-wrap;
        text-align: center;
        word-break: break-all;
        background-color: rgba(139, 69, 19, 0.9) !important;
        border-radius: .13793rem;
        -webkit-transform: translate3d(-50%,-50%,0);
        transform: translate3d(-50%,-50%,0);
        transition: .4s;
        z-index: -1;
        opacity: 0;
    }

    .gig_box {
        position: fixed;
        top: 50%;
        left: 50%;
        display: -webkit-box;
        display: -webkit-flex;
        display: flex;
        -webkit-box-orient: vertical;
        -webkit-box-direction: normal;
        -webkit-flex-direction: column;
        flex-direction: column;
        -webkit-box-align: center;
        -webkit-align-items: center;
        align-items: center;
        -webkit-box-pack: center;
        -webkit-justify-content: center;
        justify-content: center;
        box-sizing: content-box;
        width: 85px;
        max-width: 70%;
        min-height: 1.51724rem;
        padding: .27586rem;
        color: #fff;
        font-size: .24138rem;
        white-space: pre-wrap;
        text-align: center;
        word-break: break-all;
        background-color: rgba(139, 69, 19, 0.9) !important;
        border-radius: .13793rem;
        -webkit-transform: translate3d(-50%,-50%,0);
        transform: translate3d(-50%,-50%,0);
        transition: .4s;
        z-index: -1;
        opacity: 0;
    }
    .gig_box .gif {
        width: 20px !important;
    }
</style>

<div class="gig_box" id="preLoad">
    <img src="https://i.postimg.cc/kgmHqk0m/loading.gif" class="gif" alt="loading">
</div>

<div class="van-toast van-toast middle van-toast success" id="msg" style=""><i
        class="van-icon van-icon-success van-toast__icon"></i>
    <div class="van-toast__text">Message</div>
</div>

<script>
    function loading(){
        document.getElementById('preLoad').style.zIndex = '2001';
        document.getElementById('preLoad').style.opacity = '1';
    }

    function loadingOff(){
        document.getElementById('preLoad').style.zIndex = '-1';
        document.getElementById('preLoad').style.opacity = '0';
    }

    function msg(msgText){
        document.getElementById('msg').style.zIndex = '2001';
        document.getElementById('msg').style.opacity = '1';

        document.querySelector('.van-toast__text').innerHTML = msgText;
    }

    function msgOff(){
        document.getElementById('msg').style.zIndex = '-1';
        document.getElementById('msg').style.opacity = '0';
    }
</script>

</body>
</html>