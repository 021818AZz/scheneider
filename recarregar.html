<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dep√≥sito - Royal Bank Angola</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        .compact-modal {
            max-height: 85vh;
            overflow-y: auto;
            width: 95%;
            max-width: 500px;
        }
        
        .compact-modal-content {
            padding: 1rem;
        }

        /* Estilo para a barra de rolagem */
        .compact-modal::-webkit-scrollbar {
            width: 5px;
        }
        
        .compact-modal::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        .compact-modal::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        
        .compact-modal::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Estilos para os rob√¥s de minera√ß√£o */
        .mining-robot {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            cursor: pointer;
            transition: all 0.5s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 10;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            border: 3px solid #000000;
            overflow: hidden;
        }

        .mining-robot::before {
            content: "ü§ñ";
            font-size: 24px;
            position: absolute;
        }

        .mining-robot.selected {
            border: 3px solid #fbbf24;
            box-shadow: 0 0 0 4px rgba(251, 191, 36, 0.5);
            transform: scale(1.1);
        }

        .robot-content {
            position: relative;
            z-index: 2;
            text-align: center;
            color: #ffffff;
            font-weight: bold;
            font-size: 12px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
            padding: 0 5px;
        }

        .mining-container {
            position: relative;
            width: 100%;
            height: 300px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }

        .bank-info-display {
            background: #1e293b;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #334155;
            text-align: center;
        }

        .bank-name-display {
            font-size: 18px;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 5px;
        }

        .bank-desc-display {
            font-size: 14px;
            color: #94a3b8;
        }

        .confirm-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .confirm-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(30, 58, 138, 0.3);
        }

        .confirm-button:disabled {
            background: #64748b;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Loading elegante */
        .loading {
            display: none;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Mensagens de status */
        .success-message {
            background: rgba(34, 197, 94, 0.2);
            color: #16a34a;
            padding: 1.2rem;
            border-radius: 0.9rem;
            margin: 1.5rem 0;
            text-align: center;
            border: 1px solid rgba(22, 163, 74, 0.3);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.2);
            color: #dc2626;
            padding: 1.2rem;
            border-radius: 0.9rem;
            margin: 1.5rem 0;
            text-align: center;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }

        /* Estilos para a tela de informa√ß√µes banc√°rias */
        .bank-details-screen {
            display: none;
        }

        .bank-details-card {
            background: #1e293b;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #334155;
        }

        .detail-item:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #94a3b8;
        }

    .detail-value {
      font-weight: 600;
      color: #ffffff;
    }

    .copy-btn {
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 10px;
    }

    .copy-btn:hover {
      background: #2563eb;
    }

    .receipt-upload-area {
      border: 2px dashed #475569;
      border-radius: 8px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
      background: #1e293b;
    }

    .receipt-upload-area:hover {
      border-color: #3b82f6;
      background: #1e40af;
    }

    .receipt-preview {
      max-width: 100%;
      max-height: 200px;
      margin-top: 15px;
      border-radius: 8px;
      display: none;
    }

    .back-button {
      display: flex;
      align-items: center;
      gap: 8px;
      background: #334155;
      border: none;
      border-radius: 8px;
      padding: 10px 15px;
      cursor: pointer;
      font-weight: 500;
      margin-bottom: 20px;
      transition: all 0.3s ease;
      color: white;
    }

    .back-button:hover {
      background: #475569;
    }

    /* NOVOS ESTILOS PARA TEMA DE MINERA√á√ÉO */
    .mining-background {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #1e40af 100%);
      position: relative;
      overflow: hidden;
    }

    .mining-background::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(0,0,0,0.2) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(0,0,0,0.2) 0%, transparent 20%);
      pointer-events: none;
    }

    .mining-field {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 50%, #1e40af 100%);
      border: 2px solid #000000;
      border-radius: 12px;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    .mining-field::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        linear-gradient(90deg, transparent 49%, rgba(0,0,0,0.3) 50%, transparent 51%),
        linear-gradient(transparent 49%, rgba(0,0,0,0.3) 50%, transparent 51%);
      background-size: 30px 30px;
      pointer-events: none;
    }

    .bank-info-mining {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      border: 2px solid #000000;
      border-radius: 12px;
      padding: 20px;
      color: white;
      text-align: center;
      margin: 15px 0;
      position: relative;
      overflow: hidden;
    }

    .bank-info-mining::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: 
        radial-gradient(circle at 20% 30%, rgba(0,0,0,0.2) 0%, transparent 20%),
        radial-gradient(circle at 80% 70%, rgba(0,0,0,0.2) 0%, transparent 20%);
      pointer-events: none;
    }

    .mining-button {
      background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
      color: white;
      border: 2px solid #000000;
      border-radius: 8px;
      padding: 12px 20px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .mining-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(30, 58, 138, 0.4);
      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
    }

    .dark-card {
      background: #1e293b;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border: 1px solid #334155;
    }

    .blue-text {
      color: #3b82f6;
    }

    .white-text {
      color: white;
    }
    
    /* Estilo para monitores de minera√ß√£o */
    .mining-monitor {
      position: relative;
      background: #000000;
      border-radius: 8px;
      padding: 15px;
      margin: 10px 0;
      border: 2px solid #3b82f6;
      font-family: 'Courier New', monospace;
      color: #00ff00;
      overflow: hidden;
    }
    
    .mining-monitor::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(rgba(0, 255, 0, 0.05) 50%, rgba(0, 0, 0, 0.1) 50%);
      background-size: 100% 4px;
      z-index: 1;
      pointer-events: none;
    }
    
    .monitor-content {
      position: relative;
      z-index: 2;
    }
    
    .monitor-text {
      font-size: 12px;
      line-height: 1.4;
      margin: 0;
    }
    
    .monitor-flicker {
      animation: flicker 0.5s infinite alternate;
    }
    
    @keyframes flicker {
      0% { opacity: 0.7; }
      100% { opacity: 1; }
    }
  </style>
</head>

<body class="bg-slate-900 text-white min-h-screen font-sans">
  <div class="max-w-md mx-auto pb-24">
    <!-- Header -->
    <header class="mining-background shadow-sm sticky top-0 z-40 flex items-center justify-between px-5 py-4 border-b border-blue-600">
      <button onclick="history.back()" class="text-white text-2xl font-bold hover:text-blue-300">
        &#8592;
      </button>
      <h1 class="text-lg font-bold text-white tracking-tight">√Årea de Dep√≥sito</h1>
      <a href="geral.html" class="text-sm text-white hover:underline">Ver extrato</a>
    </header>

    <!-- Tela de sele√ß√£o de banco (inicial) -->
    <div id="bankSelectionScreen">
      <!-- Cart√£o do saldo -->
      <section class="px-5 mt-6">
        <div class="mining-field text-white p-5 flex items-center justify-between">
          <div>
            <p class="text-sm opacity-90 mb-1">Saldo atual</p>
            <p class="text-2xl font-bold" id="userBalance">KZ 0,00</p>
          </div>
          <div class="w-12 h-12 bg-black rounded-full flex items-center justify-center">
            <span class="text-blue-500 font-bold text-lg">‚õèÔ∏è</span>
          </div>
        </div>
      </section>

      <!-- Seletor de valores -->
      <section class="px-5 mt-8">
        <p class="text-sm font-medium text-blue-300 mb-2">Selecione um valor r√°pido</p>
        <div class="grid grid-cols-3 gap-3">
          <button data-value="5000" class="mining-button text-sm font-semibold py-2 text-center">KZ 5.000</button>
          <button data-value="15000" class="mining-button text-sm font-semibold py-2 text-center">KZ 15.000</button>
          <button data-value="30000" class="mining-button text-sm font-semibold py-2 text-center">KZ 30.000</button>
          <button data-value="50000" class="mining-button text-sm font-semibold py-2 text-center">KZ 50.000</button>
          <button data-value="100000" class="mining-button text-sm font-semibold py-2 text-center">KZ 100.000</button>
          <button data-value="250000" class="mining-button text-sm font-semibold py-2 text-center">KZ 250.000</button>
        </div>
      </section>

      <!-- Formul√°rio -->
      <section class="px-5 mt-6">
        <form id="depositForm" class="space-y-5">
          <div>
            <label for="valorInput" class="text-sm font-medium text-blue-300 block mb-1">Outro valor</label>
            <div class="flex items-center bg-slate-800 border border-blue-500 rounded-lg px-3 py-2">
              <span class="text-blue-400 font-semibold mr-2">KZ</span>
              <input required name="amount" id="valorInput" type="number" class="w-full bg-transparent outline-none placeholder-blue-400 text-white" placeholder="Digite um valor" value="" min="5000" />
            </div>
          </div>

          <div>
            <p class="text-sm font-medium text-blue-300 mb-2">Escolha o banco para dep√≥sito</p>
            <div class="bank-info-mining cursor-pointer" onclick="openBankModal()">
              <div class="flex items-center">
                <div class="w-10 h-10 rounded-full bg-black flex items-center justify-center mr-3">
                  <span class="text-blue-500 font-bold">‚õèÔ∏è</span>
                </div>
                <div class="bank-info">
                  <div class="bank-name font-medium" id="selectedBankName">Selecione o banco</div>
                  <div class="bank-desc text-blue-200 text-sm" id="selectedBankDesc">Toque para escolher com os rob√¥s de minera√ß√£o</div>
                </div>
                <svg class="w-5 h-5 text-white ml-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
              </div>
            </div>
            <input type="hidden" id="bankCode" value="">
          </div>

          <button type="button" onclick="validateForm()" id="btnDepositar" class="w-full mining-button font-semibold py-3 shadow">Depositar agora</button>
        </form>

        <!-- Monitores de minera√ß√£o -->
        <div class="mt-6">
          <div class="mining-monitor">
            <div class="monitor-content">
              <p class="monitor-text monitor-flicker">> INICIANDO SISTEMA DE MINERA√á√ÉO...</p>
              <p class="monitor-text">> CONECTANDO √Ä REDE BANC√ÅRIA...</p>
              <p class="monitor-text">> AGUARDANDO SELE√á√ÉO DE BANCO...</p>
            </div>
          </div>
        </div>

        <div class="mt-6 text-xs text-blue-300 leading-relaxed space-y-3">
          <h2 class="text-sm font-bold">Informa√ß√µes de Recarga</h2>
          <div class="flex items-start gap-2">
            <div class="w-4 h-4 bg-blue-500 rounded-full animate-pulse mt-1"></div>
            <p>O valor m√≠nimo de recarga √© de <strong>KZ 4.000</strong>.</p>
          </div>

          <div class="flex items-start gap-2">
            <div class="w-4 h-4 bg-yellow-500 rounded-full animate-bounce mt-1"></div>
            <p><strong>Voc√™ deve enviar uma nova solicita√ß√£o de recarga para cada dep√≥sito</strong>.</p>
          </div>

          <div class="flex items-start gap-2">
            <div class="w-4 h-4 bg-white rounded-full animate-pulse mt-1"></div>
            <p><strong>Caso encontre algum problema durante o processo de recarga, entre em contato com o <a class="underline" href="https://t.me/+PbM_coC8sSUxOTQ0">Atendimento ao Cliente.</a></strong></p>
          </div>
        </div>
      </section>
    </div>

    <!-- Tela de informa√ß√µes banc√°rias (aparece ap√≥s selecionar um banco) -->
    <div id="bankDetailsScreen" class="bank-details-screen px-5">
      <button class="back-button" onclick="goBackToSelection()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
        </svg>
        Voltar
      </button>

      <div class="mining-field text-white">
        <h2 class="text-xl font-bold mb-4 text-center">Informa√ß√µes para Dep√≥sito</h2>
        
        <div class="bg-black bg-opacity-40 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">Banco Selecionado:</span>
            <span class="font-bold" id="detailBankName">-</span>
          </div>
        </div>
        
        <div class="bg-black bg-opacity-40 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">Nome do Benefici√°rio:</span>
            <span class="font-bold" id="detailBeneficiary">-</span>
          </div>
        </div>
        
        <div class="bg-black bg-opacity-40 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">N√∫mero da Conta (IBAN):</span>
            <div class="flex items-center">
              <span class="font-bold mr-2" id="detailIban">-</span>
              <button class="bg-black text-blue-500 px-2 py-1 rounded text-xs font-bold" onclick="copyToClipboard('detailIban')">Copiar</button>
            </div>
          </div>
        </div>
        
        <div class="bg-black bg-opacity-40 rounded-lg p-4 mb-3">
          <div class="flex justify-between items-center">
            <span class="font-medium">Refer√™ncia:</span>
            <div class="flex items-center">
              <span class="font-bold mr-2" id="detailReference">-</span>
              <button class="bg-black text-blue-500 px-2 py-1 rounded text-xs font-bold" onclick="copyToClipboard('detailReference')">Copiar</button>
            </div>
          </div>
        </div>
        
        <div class="bg-black bg-opacity-40 rounded-lg p-4">
          <div class="flex justify-between items-center">
            <span class="font-medium">Valor do Dep√≥sito:</span>
            <span class="font-bold" id="detailAmount">-</span>
          </div>
        </div>
      </div>

      <div class="dark-card mt-6">
        <h3 class="text-lg font-semibold text-blue-400 mb-4">Enviar Comprovante</h3>
        
        <div class="receipt-upload-area border-blue-500" onclick="openGallery()">
          <input type="file" id="receiptInput" accept="image/*" class="hidden" onchange="handleReceiptUpload(event)">
          <div class="flex flex-col items-center">
            <div class="w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center mb-2">
              <span class="text-blue-500 text-xl">‚õèÔ∏è</span>
            </div>
            <p class="text-blue-300 font-medium">Clique para enviar o comprovante</p>
            <p class="text-blue-400 text-sm mt-1">PNG, JPG (MAX. 5MB)</p>
          </div>
        </div>
        
        <img id="receiptPreview" class="receipt-preview">
        <p id="fileName" class="text-sm text-blue-400 mt-2 text-center hidden"></p>
        
        <button id="submitDepositBtn" class="w-full mining-button font-semibold py-3 shadow mt-4" onclick="submitDeposit()" disabled>Confirmar Dep√≥sito</button>
      </div>

      <!-- Monitor de minera√ß√£o na tela de detalhes -->
      <div class="mt-6">
        <div class="mining-monitor">
          <div class="monitor-content">
            <p class="monitor-text monitor-flicker">> BANCO SELECIONADO: <span id="monitorBankName">-</span></p>
            <p class="monitor-text">> VALOR: <span id="monitorAmount">-</span></p>
            <p class="monitor-text">> STATUS: AGUARDANDO COMPROVANTE...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal de Sele√ß√£o de Bancos com Rob√¥s de Minera√ß√£o -->
    <div id="bankModal" class="fixed inset-0 z-50 hidden items-center justify-center backdrop-blur-sm bg-black/40" onclick="closeBankModal(event)">
      <div onclick="event.stopPropagation()" class="mining-field compact-modal">
        <div class="compact-modal-content">
          <div class="flex justify-between items-center border-b border-blue-500 pb-3 mb-3">
            <h3 class="text-lg font-bold text-white">Selecione o Banco</h3>
            <button onclick="closeBankModal()" class="text-white hover:text-blue-300 text-xl font-bold">√ó</button>
          </div>
          
          <div class="text-center mb-4">
            <p class="text-blue-200">Escolha um banco tocando em um rob√¥ de minera√ß√£o</p>
          </div>
          
          <div class="mining-container" id="miningContainer">
            <!-- Os rob√¥s de minera√ß√£o ser√£o inseridos aqui via JavaScript -->
          </div>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div id="loading" class="fixed inset-0 bg-black/50 z-50 hidden items-center justify-center">
      <div class="mining-field p-6 rounded-xl shadow-lg flex flex-col items-center">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-white mb-4"></div>
        <p class="text-white">Processando seu dep√≥sito...</p>
      </div>
    </div>
  </div>

  <!-- Menu de navega√ß√£o com √≠cones de imagem -->
    <nav class="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-[500px] z-50 shadow-xl border-t border-blue-800 rounded-t-2xl overflow-hidden">
      <ul class="flex justify-around items-center py-2 bg-gradient-to-r from-blue-800 via-blue-900 to-black text-white text-xs">
        
        <li>
          <a href="indice.html" class="flex flex-col items-center gap-0.5 font-bold">
            <img src="footer/inicio.png" alt="In√≠cio" class="w-6 h-6">
            <span>In√≠cio</span>
          </a>
        </li>
        
        <li>
          <a href="r.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="footer/meusprodutos.png" alt="Renda" class="w-6 h-6">
            <span>Meus produtos</span>
          </a>
        </li>
        
        <li>
          <a href="mostrar.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="footer/mostrar.png" alt="VIP" class="w-6 h-6">
            <span>Mostrar</span>
          </a>
        </li>
        
        <li>
          <a href="compartilhar.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="footer/compartilhar.png" alt="Banc√°ria" class="w-6 h-6">
            <span>Compartilhar</span>
          </a>
        </li>
        
        <li>
          <a href="meu.html" class="flex flex-col items-center gap-0.5 opacity-80">
            <img src="footer/meu.png" alt="Perfil" class="w-6 h-6">
            <span>Meu</span>
          </a>
        </li>

      </ul>
    </nav>


  <script>
    // Configura√ß√µes
    const API_BASE_URL = 'https://bd-p4q7.onrender.com';
    let depositData = {};
    let receiptFile = null;
    let selectedBank = '';
    let depositAmount = 0;

    // Informa√ß√µes dos bancos
    const bankInfo = {
        'BAI': {
            name: 'BAI',
            fullName: 'BAI - Banco Angolano de Investimentos',
            beneficiary: 'Welwitchia dos Santos',
            iban: '004000008865089410140',
            reference: 'Welwitchia dos Santos' + Math.floor(10000 + Math.random() * 90000)
        },
        'BFA': {
            name: 'BFA',
            fullName: 'BFA - Banco de Fomento Angola',
            beneficiary: 'Welwitchia dos Santos',
            iban: '000600005019428830154',
            reference: 'Welwitchia dos Santos' + Math.floor(10000 + Math.random() * 90000)
        },
        'BIC': {
            name: 'BIC',
            fullName: 'BIC - Banco Internacional de Cr√©dito',
            beneficiary: 'JOSE CABRAL',
            iban: '005100004466131910167',
            reference: 'JOSE CABRAL' + Math.floor(10000 + Math.random() * 90000)
        },
        'ATL': {
            name: 'ATL',
            fullName: 'ATL - Banco Atl√¢ntico',
            beneficiary: 'MAbjfghfURIhfdhfCIiieuO',
            iban: 'XXXXXXXXXXXXXXXX',
            reference: 'XXXXXX' + Math.floor(10000 + Math.random() * 90000)
        }
    };

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function() {
        if (!isTokenValid()) {
            window.location.href = '/index.html';
            return;
        }
        loadUserData();
        setupEventListeners();
    });

    // Configurar listeners
    function setupEventListeners() {
        // Selecionar valor r√°pido
        const amountButtons = document.querySelectorAll('[data-value]');
        const depositInput = document.getElementById('valorInput');

        amountButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                const value = this.getAttribute('data-value');
                depositInput.value = value;
                
                // Ativar visualmente o bot√£o clicado
                amountButtons.forEach(b => b.classList.remove('bg-blue-800', 'text-white'));
                this.classList.add('bg-blue-800', 'text-white');
            });
        });

        // Validar input manual
        depositInput.addEventListener('input', function() {
            // Remover sele√ß√£o dos bot√µes quando digitar manualmente
            amountButtons.forEach(b => b.classList.remove('bg-blue-800', 'text-white'));
        });
    }

    // Carregar dados do usu√°rio
    async function loadUserData() {
        showLoading(true);
        try {
            const token = getToken();
            const response = await fetch(`${API_BASE_URL}/api/user/profile`, {
                headers: { 
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });
            
            if (response.ok) {
                const data = await response.json();
                if (data.success) {
                    const saldo = data.data.wallet_balance || 0;
                    document.getElementById('userBalance').textContent = `KZ ${saldo.toLocaleString('pt-AO')}`;
                }
            } else {
                throw new Error('Falha ao carregar dados do usu√°rio');
            }
        } catch (error) {
            console.error('Erro ao carregar dados:', error);
            showError('Erro ao carregar dados do usu√°rio');
        } finally {
            showLoading(false);
        }
    }

    // Abrir modal de sele√ß√£o de bancos
    function openBankModal() {
        document.getElementById('bankModal').classList.remove('hidden');
        document.getElementById('bankModal').classList.add('flex');
        
        // Inicializar os rob√¥s de minera√ß√£o
        initMiningRobots();
    }

    // Fechar modal
    function closeBankModal(event) {
        if (!event || event.target.id === "bankModal") {
            document.getElementById("bankModal").classList.add("hidden");
            document.getElementById("bankModal").classList.remove("flex");
        }
    }

    // Inicializar os rob√¥s de minera√ß√£o
    function initMiningRobots() {
        const container = document.getElementById('miningContainer');
        container.innerHTML = '';
        
        const banks = ['BAI', 'BFA', 'BIC', 'ATL'];
        const radius = 120;
        const centerX = container.offsetWidth / 2;
        const centerY = container.offsetHeight / 2;
        
        banks.forEach((bankCode, index) => {
            const robot = document.createElement('div');
            robot.className = 'mining-robot';
            robot.id = `robot-${bankCode}`;
            robot.dataset.bank = bankCode;
            
            const robotContent = document.createElement('div');
            robotContent.className = 'robot-content';
            robotContent.textContent = bankInfo[bankCode].name;
            robot.appendChild(robotContent);
            
            // Posi√ß√£o inicial aleat√≥ria
            const startX = Math.random() * 100 - 50;
            const startY = Math.random() * 100 - 50;
            
            robot.style.left = `${startX}px`;
            robot.style.top = `${startY}px`;
            
            container.appendChild(robot);
            
            // Anima√ß√£o para mover o rob√¥ para sua posi√ß√£o no c√≠rculo
            setTimeout(() => {
                const angle = (index / banks.length) * 2 * Math.PI;
                const x = centerX + radius * Math.cos(angle) - 40;
                const y = centerY + radius * Math.sin(angle) - 40;
                
                robot.style.left = `${x}px`;
                robot.style.top = `${y}px`;
            }, 100 * index);
            
            // Adicionar evento de clique
            robot.addEventListener('click', () => selectMiningRobot(bankCode));
        });
    }

    // Selecionar um rob√¥ de minera√ß√£o
    function selectMiningRobot(bankCode) {
        selectedBank = bankCode;
        
        // Atualizar informa√ß√µes do banco selecionado
        document.getElementById('selectedBankName').textContent = bankInfo[bankCode].fullName;
        document.getElementById('selectedBankDesc').textContent = `Banco selecionado: ${bankInfo[bankCode].name}`;
        document.getElementById('bankCode').value = bankCode;
        
        // Fechar o modal
        closeBankModal();
    }

    // Validar formul√°rio (na tela de sele√ß√£o)
    function validateForm() {
        const valorInput = document.getElementById('valorInput');
        depositAmount = parseFloat(valorInput.value) || 0;
        
        // Validar valor
        if (!depositAmount || depositAmount < 4000) {
            showError('Por favor, insira um valor v√°lido (m√≠nimo KZ 4.000)');
            return;
        }
        
        if (!selectedBank) {
            showError('Selecione um banco para continuar');
            openBankModal();
            return;
        }

        // Mostrar tela de detalhes
        showBankDetails();
    }

    // Mostrar tela de informa√ß√µes banc√°rias
    function showBankDetails() {
        // Atualizar informa√ß√µes na tela de detalhes
        document.getElementById('detailBankName').textContent = bankInfo[selectedBank].fullName;
        document.getElementById('detailBeneficiary').textContent = bankInfo[selectedBank].beneficiary;
        document.getElementById('detailIban').textContent = bankInfo[selectedBank].iban;
        document.getElementById('detailReference').textContent = bankInfo[selectedBank].reference;
        document.getElementById('detailAmount').textContent = `KZ ${depositAmount.toLocaleString('pt-AO')}`;
        
        // Atualizar monitor de minera√ß√£o
        document.getElementById('monitorBankName').textContent = bankInfo[selectedBank].name;
        document.getElementById('monitorAmount').textContent = `KZ ${depositAmount.toLocaleString('pt-AO')}`;
        
        // Preparar dados para a API
        depositData = {
            amount: depositAmount,
            account_name: bankInfo[selectedBank].beneficiary,
            iban: bankInfo[selectedBank].iban,
            bank_name: bankInfo[selectedBank].fullName,
            bank_code: selectedBank
        };
        
        // Mostrar tela de detalhes e esconder tela de sele√ß√£o
        document.getElementById('bankSelectionScreen').style.display = 'none';
        document.getElementById('bankDetailsScreen').style.display = 'block';
    }

    // Voltar para a tela de sele√ß√£o
    function goBackToSelection() {
        document.getElementById('bankDetailsScreen').style.display = 'none';
        document.getElementById('bankSelectionScreen').style.display = 'block';
        receiptFile = null;
        
        // Resetar preview
        document.getElementById('receiptPreview').style.display = 'none';
        document.getElementById('fileName').classList.add('hidden');
        document.getElementById('submitDepositBtn').disabled = true;
    }

    // Fun√ß√£o para abrir a galeria
    function openGallery() {
        document.getElementById('receiptInput').click();
    }

    // Upload do comprovante
    function handleReceiptUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        // Validar tamanho (5MB m√°ximo)
        if (file.size > 5 * 1024 * 1024) {
            showError('Arquivo muito grande. M√°ximo 5MB.');
            return;
        }

        // Validar tipo
        if (!file.type.match('image.*')) {
            showError('Por favor, selecione uma imagem (JPG, PNG).');
            return;
        }

        receiptFile = file;

        // Mostrar preview
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('receiptPreview');
            preview.src = e.target.result;
            preview.style.display = 'block';
            
            // Mostrar nome do arquivo
            const fileNameElement = document.getElementById('fileName');
            fileNameElement.textContent = `Arquivo selecionado: ${file.name}`;
            fileNameElement.classList.remove('hidden');
            
            // Habilitar bot√£o de confirma√ß√£o
            document.getElementById('submitDepositBtn').disabled = false;
            
            // Atualizar monitor de minera√ß√£o
            document.querySelector('#bankDetailsScreen .monitor-text:nth-child(3)').textContent = '> STATUS: COMPROVANTE CARREGADO - PRONTO PARA ENVIO';
        };
        reader.readAsDataURL(file);
        
        clearError();
    }

    // Submeter dep√≥sito
    async function submitDeposit() {
        if (!receiptFile) {
            showError('Por favor, envie o comprovante');
            return;
        }

        showLoading(true);

        try {
            const token = getToken();
            const formData = new FormData();
            formData.append('receipt', receiptFile);

            // 1. Criar solicita√ß√£o de dep√≥sito
            const depositResponse = await fetch(`${API_BASE_URL}/api/deposit`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify(depositData)
            });

            const depositResult = await depositResponse.json();

            if (!depositResult.success) {
                throw new Error(depositResult.message || 'Erro ao criar dep√≥sito');
            }

            // 2. Upload do comprovante
            formData.append('deposit_id', depositResult.data.deposit_id);
            
            const uploadResponse = await fetch(`${API_BASE_URL}/api/deposit-receipt`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData
            });

            const uploadResult = await uploadResponse.json();

            if (!uploadResult.success) {
                throw new Error(uploadResult.message || 'Erro ao enviar comprovante');
            }

            // Sucesso
            showSuccess('Dep√≥sito solicitado com sucesso! Aguarde a confirma√ß√£o.');
            
            // Redirecionar ap√≥s 3 segundos
            setTimeout(() => {
                window.location.href = 'geral.html';
            }, 3000);

        } catch (error) {
            console.error('Erro ao processar dep√≥sito:', error);
            showError('Erro ao processar dep√≥sito: ' + error.message);
        } finally {
            showLoading(false);
        }
    }

    // Copiar para a √°rea de transfer√™ncia
    function copyToClipboard(elementId) {
        const element = document.getElementById(elementId);
        const text = element.textContent;
        
        navigator.clipboard.writeText(text).then(() => {
            showTemporaryMessage('Copiado para a √°rea de transfer√™ncia!');
        }).catch(err => {
            console.error('Erro ao copiar:', err);
            // Fallback para m√©todo antigo
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showTemporaryMessage('Copiado!');
        });
    }

    // Fun√ß√µes auxiliares
    function showTemporaryMessage(message) {
        const msgDiv = document.createElement('div');
        msgDiv.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            z-index: 10000;
            font-size: 14px;
            font-weight: 500;
        `;
        msgDiv.textContent = message;
        document.body.appendChild(msgDiv);
        
        setTimeout(() => {
            document.body.removeChild(msgDiv);
        }, 2000);
    }

    function showError(message) {
        alert('Erro: ' + message);
    }

    function showSuccess(message) {
        alert('Sucesso: ' + message);
    }

    function clearError() {
        // Implementa√ß√£o para limpar mensagens de erro se necess√°rio
    }

    function showLoading(show) {
        const loading = document.getElementById('loading');
        if (show) {
            loading.classList.remove('hidden');
            loading.classList.add('flex');
        } else {
            loading.classList.add('hidden');
            loading.classList.remove('flex');
        }
    }

    // Fun√ß√µes de autentica√ß√£o
    function isTokenValid() {
        const tokenData = localStorage.getItem('user_token');
        if (!tokenData) return false;
        
        try {
            const { token, expiry } = JSON.parse(tokenData);
            return Date.now() < expiry;
        } catch (e) {
            return false;
        }
    }

    function getToken() {
        const tokenData = localStorage.getItem('user_token');
        if (!tokenData) return null;
        
        try {
            const { token } = JSON.parse(tokenData);
            return token;
        } catch (e) {
            return null;
        }
    }
</script>
</body>
</html>